function MyNewSweeper(e){e.classes=$.extend({},defaults.classes,e.classes),gOpts=$.extend({},defaults,e),MNS_init(),start()}function MNS_init(){gOpts.row="<div class='"+gOpts.classes.rows+"'></div>",gOpts.cell="<div class='"+gOpts.classes.allCells+" "+gOpts.classes.hidden+"'><strong></strong></div>"}function start(){cellSelector="."+gOpts.classes.allCells.split(" ").join("."),geraCampo(),geraMinas(),geraVizinhanca(),updateCellsToWin(),$(cellSelector).on("mousedown",function(e){var s=$(this),n=s.attr("x"),t=s.attr("y");switch(gOpts.onClick(),event.which){case 1:teste(function(){console.log("Left Click on ",n,t)}),clickLeft(n,t);break;case 3:teste(function(){console.log("Right Click on: ",n,t)}),clickRight(n,t)}}),$(gOpts.gameSelector).attr("oncontextmenu","return false;")}function teste(e){TEST&&e()}function clickRight(e,s){campoMatrix[e][s]==SAFE||campoMatrix[e][s]==MINE?(teste(function(){console.log("Adding FLAG")}),campoMatrix[e][s]+=FLAG,selectCell(e,s).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.flag)):campoMatrix[e][s]!=REVELADO&&(teste(function(){console.log("Removing FLAG")}),campoMatrix[e][s]-=FLAG,selectCell(e,s).removeClass(gOpts.classes.flag).addClass(gOpts.classes.hidden))}function gameOver(e){e(),gOpts.restartOnGameOver&&start()}function clickLeft(e,s){return campoMatrix[e][s]==MINE?(revealMines(),selectCell(e,s).removeClass(gOpts.classes.mine).addClass(gOpts.classes.clickedMine),void gameOver(gOpts.onGameOver)):void((campoMatrix[e][s]==SAFE||campoMatrix[e][s]==MINE)&&(revelar(e,s),updateCellsToWin()))}function revealMines(){for(var e=0;e<gOpts.numRows;e++)for(var s=0;s<gOpts.numColumns;s++)campoMatrix[e][s]==MINE?selectCell(e,s).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.mine):campoMatrix[e][s]==SAFE+FLAG&&selectCell(e,s).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.wrongFlag)}function updateCellsToWin(){if(gOpts.cellsToWinMsg!==!1){var e={"#cellsToWin#":cellsToWin};$(gOpts.cellsToWinSelector).text(replaceAll(gOpts.cellsToWinMsg,e))}0==cellsToWin&&gameOver(gOpts.onWin)}function revelar(e,s){cellsToWin--,campoMatrix[e][s]=REVELADO;var n=selectCell(e,s),t=n.attr(minasVizinhasAttr);n=n.removeClass(gOpts.classes.hidden).addClass(gOpts.classes.revealed),0==t?abreVizinhos(parseInt(e),parseInt(s)):n.find("strong").text(t).css("color",gOpts.numberColors[t-1])}function abreVizinhos(e,s){for(var n=e-1;e+1>=n;n++)if(n>=0&&n<gOpts.numRows)for(var t=s-1;s+1>=t;t++)t>=0&&t<gOpts.numColumns&&campoMatrix[n][t]==SAFE&&revelar(n,t)}function geraCampo(){teste(function(){console.log("Gerando Campo: ",gOpts.numRows,"x",gOpts.numColumns)});var e=$(gOpts.gameSelector);e.empty(),campoMatrix=[];for(var s=0;s<gOpts.numRows;s++){var n=$(gOpts.row).appendTo(e);campoMatrix[s]=[];for(var t=0;t<gOpts.numColumns;t++)campoMatrix[s][t]=SAFE,$(gOpts.cell).appendTo(n).attr("x",s).attr("y",t)}}function geraMinas(){if(isNaN(gOpts.numMines)){if(!dificulties.hasOwnProperty(gOpts.numMines))throw new Error("Incorrect numMines parameter. Use some number or some of the available dificulties: "+Object.keys(dificulties).join(","));gOpts.numMines=Math.floor(gOpts.numRows*gOpts.numColumns*dificulties[gOpts.numMines])}else if(gOpts.numMines/(gOpts.numRows*gOpts.numColumns)>gOpts.mineLimit&&(gOpts.numMines=Math.floor(gOpts.numRows*gOpts.numColumns*gOpts.mineLimit),tooManyMinesMsg!==!1)){var e={"#percent#":100*gOpts.mineLimit+"%","#numberOfMines#":gOpts.numMines};gOpts.onExceedNumberOfMines(replaceAll(gOpts.tooManyMinesMsg,e))}cellsToWin=gOpts.numRows*gOpts.numColumns-gOpts.numMines,teste(function(){console.log("Gerando "+gOpts.numMines+" minas")});for(var s=0;s<gOpts.numMines;s++){var n,t;do n=randomIntFromInterval(0,gOpts.numRows-1),t=randomIntFromInterval(0,gOpts.numColumns-1);while(campoMatrix[n][t]!=SAFE);campoMatrix[n][t]=MINE,teste(function(){selectCell(n,t).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.mine)})}}function geraVizinhanca(){for(var e=0;e<gOpts.numRows;e++)for(var s=0;s<gOpts.numColumns;s++)campoMatrix[e][s]==SAFE&&selectCell(e,s).attr(minasVizinhasAttr,contaMinasVizinhas(e,s))}function replaceAll(e,s){for(var n in s)e=e.replace(n,s[n]);return e}function contaMinasVizinhas(e,s){for(var n=0,t=e-1;e+1>=t;t++)if(t>=0&&t<gOpts.numRows)for(var a=s-1;s+1>=a;a++)a>=0&&a<gOpts.numColumns&&campoMatrix[t][a]==MINE&&n++;return n}function randomIntFromInterval(e,s){return Math.floor(Math.random()*(s-e+1)+e)}function selectCell(e,s){return $(cellSelector+'[x="'+e+'"][y="'+s+'"]')}var SAFE=0,MINE=1,FLAG=2,REVELADO=4,TEST=!1,dificulties={easy:.07,medium:.2,hard:.33,luckiest:.4},campoMatrix=[],gOpts,cellsToWin,cellSelector,minasVizinhasAttr="nm",defaults={gameSelector:"#game",cellsToWinSelector:"#toWin",timeSelector:"#elapsedTime",restartOnGameOver:!0,numRows:12,numColumns:12,numMines:20,tooManyMinesMsg:"The number of mines can't exceed #percent# of the number of cells. Using #numberOfMines# mines this round.",cellsToWinMsg:"#cellsToWin# remaining hidden cells.",classes:{rows:"row",flag:"btn-success",clickedMine:"btn-primary",hidden:"btn-info",mine:"btn-danger",revealed:"btn-default",wrongFlag:"btn-warning",allCells:"btn cell"},numberColors:["#421ecc","#c30f19","#42b60b","#d7a3c2","#cc38ba","#76471f","#1ddffb","#177a70"],mineLimit:.75,onGameOver:function(){alert("Game Over!")},onClick:function(){},onWin:function(){alert("You won!")},onExceedNumberOfMines:function(e){alert(e)}};