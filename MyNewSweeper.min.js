function MyNewSweeper(s){s.classes=$.extend({},defaults.classes,s.classes),gOpts=$.extend({},defaults,s),gOpts.init(),geraCampo(),$("body").on("mousedown","."+gOpts.classes.allCells.split(" ").join("."),function(s){var e=$(this),n=e.attr("x"),t=e.attr("y");switch(gOpts.onClick(),event.which){case 1:teste(function(){console.log("Left Click on ",n,t)}),clickLeft(n,t);break;case 2:break;case 3:teste(function(){console.log("Right Click on: ",n,t)}),clickRight(n,t)}}),geraMinas(),geraVizinhanca(),updateCellsToWin()}function teste(s){gOpts.test&&s()}function clickRight(s,e){campoMatrix[s][e]==SAFE||campoMatrix[s][e]==MINE?(teste(function(){console.log("Adding FLAG")}),campoMatrix[s][e]+=FLAG,selectCell(s,e).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.flag)):campoMatrix[s][e]!=REVELADO&&(teste(function(){console.log("Removing FLAG")}),campoMatrix[s][e]-=FLAG,selectCell(s,e).removeClass(gOpts.classes.flag).addClass(gOpts.classes.hidden))}function clickLeft(s,e){return campoMatrix[s][e]==MINE?(revealMines(),void gOpts.onGameOver()):void(campoMatrix[s][e]!=FLAG&&campoMatrix[s][e]!=REVELADO&&revelarClicado(s,e))}function revealMines(){for(var s=0;s<gOpts.numRows;s++)for(var e=0;e<gOpts.numColumns;e++)campoMatrix[s][e]==MINE&&selectCell(s,e).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.mine)}function updateCellsToWin(){$(gOpts.cellsToWin).text(gOpts.cellsToWinMsg.replace("#cellsToWin#",cellsToWin)),0==cellsToWin&&gOpts.onWin()}function revelarClicado(s,e){cellsToWin--,campoMatrix[s][e]=REVELADO;var n=selectCell(s,e),t=n.attr(minasVizinhasAttr);n=n.removeClass(gOpts.classes.hidden).addClass(gOpts.classes.revealed),0!=t&&n.find("strong").text(t).css("color",gOpts.numberColors[t-1]),updateCellsToWin(),0==t&&abreVizinhos(s,e)}function abreVizinhos(s,e){for(var n=s-1;s+1>=n;n++)if(n>=0&&n<gOpts.numRows)for(var t=e-1;e+1>=t;t++)t>=0&&t<gOpts.numColumns&&campoMatrix[n][t]==SAFE&&revelarClicado(n,t)}function geraCampo(){teste(function(){console.log("Gerando Campo: ",gOpts.numRows,"x",gOpts.numColumns)});var s=$(gOpts.gameElement);s.empty(),campoMatrix=[];for(var e=0;e<gOpts.numRows;e++){var n=$(gOpts.row).appendTo(s);campoMatrix[e]=[];for(var t=0;t<gOpts.numColumns;t++)campoMatrix[e][t]=SAFE,$(gOpts.cell).appendTo(n).attr("x",e).attr("y",t)}}function geraMinas(){if(gOpts.numMines/(gOpts.numRows*gOpts.numColumns)>gOpts.mineLimit){gOpts.numMines=Math.floor(gOpts.numRows*gOpts.numColumns*gOpts.mineLimit);var s=gOpts.tooManyMinesMsg.replace("#percent#",100*gOpts.mineLimit+"%");s=s.replace("#numberOfMines#",gOpts.numMines),gOpts.onExceedNumerOfMines(s)}cellsToWin=gOpts.numRows*gOpts.numColumns-gOpts.numMines,teste(function(){console.log("Gerando "+gOpts.numMines+" minas")});for(var e=0;e<gOpts.numMines;e++){var n,t;do n=randomIntFromInterval(0,gOpts.numRows-1),t=randomIntFromInterval(0,gOpts.numColumns-1);while(campoMatrix[n][t]!=SAFE);campoMatrix[n][t]=MINE,teste(function(){selectCell(n,t).removeClass(gOpts.classes.hidden).addClass(gOpts.classes.mine)})}}function geraVizinhanca(){for(var s=0;s<gOpts.numRows;s++)for(var e=0;e<gOpts.numColumns;e++)campoMatrix[s][e]==SAFE&&selectCell(s,e).attr(minasVizinhasAttr,contaMinasVizinhas(s,e))}function contaMinasVizinhas(s,e){for(var n=0,t=s-1;s+1>=t;t++)if(t>=0&&t<gOpts.numRows)for(var a=e-1;e+1>=a;a++)a>=0&&a<gOpts.numColumns&&campoMatrix[t][a]==MINE&&n++;return n}function randomIntFromInterval(s,e){return Math.floor(Math.random()*(e-s+1)+s)}function selectCell(s,e){return $('.cell[x="'+s+'"][y="'+e+'"]')}var SAFE=0,MINE=1,FLAG=2,REVELADO=4,campoMatrix=[],gOpts,cellsToWin,minasVizinhasAttr="nm",defaults={gameElement:"#game",cellsToWin:"#toWin",numRows:12,numColumns:12,numMines:20,tooManyMinesMsg:"The number of mines can't exceed #percent# of the blocks. Using #numberOfMines# mines this round.",cellsToWinMsg:"#cellsToWin# remaining hidden cells.",test:!1,classes:{rows:"row",flag:"btn-success",hidden:"btn-info",mine:"btn-danger",revealed:"btn-default",allCells:"cell btn"},numberColors:["#421ecc","#c30f19","#42b60b","#d7a3c2","#cc38ba","#76471f","#1ddffb","#177a70"],mineLimit:.75,init:function(){this.row="<div class='"+this.classes.rows+"'></div>",this.cell="<div class='"+this.classes.allCells+" "+this.classes.hidden+"'><strong></strong></div>"},onGameOver:function(){alert("Game Over!")},onClick:function(){},onWin:function(){alert("You won!")},onExceedNumerOfMines:function(s){alert(s)}};
